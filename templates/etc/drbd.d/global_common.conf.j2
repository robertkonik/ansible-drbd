# {{ ansible_managed }}
global {
	usage-count no;
}

common {
	handlers {
	}

	startup {
	}

	options {
	}

	net {
    cram-hmac-alg sha1;
    shared-secret "{{ drbd_network_shared_secret }}";
	}
}

{% for disk in drbd_disks %}
{% set resource_port = 7788 %}
resource {{ disk['resource'] }} {
{%   for host in groups[drbd_group] %}
  on {{ hostvars[host]['inventory_hostname_short'] }} {
    device {{ disk['device'] }};
    disk {{ disk['use_partition'] }};
    address {{ hostvars[host]['ansible_' + drbd_interface]['ipv4']['address'] }}:{{ resource_port }};
    meta-disk internal;
  }
{%   endfor %}
}
{% set resource_port = resource_port + 1 %}
{% endfor %}
